FROM php:7.3.0-fpm-alpine3.8

MAINTAINER lubinlew "https://github.com/LubinLew"

## change apk sources(optional)
RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories

## STEP1, config php-fpm
COPY reproducer/index.php       /var/www/html/
COPY reproducer/php-fpm.conf    /etc/nginx/

## STEP2, config nginx
RUN apk add --no-cache nginx
COPY reproducer/fastcgi_params  /etc/nginx/
COPY reproducer/nginx.conf      /etc/nginx/

## STEP3, config supervisor, so we can keep both nginx and php-fpm in one docker
RUN apk add --no-cache supervisor
RUN mkdir -p /var/log/supervisor
COPY reproducer/supervisord.conf /etc/supervisord.conf

## nginx default port
EXPOSE 80

## overwrite php's original ENTRYPOINT
ENTRYPOINT ["/usr/bin/supervisord"]
